<!DOCTYPE html>
<html lang="en">
<head>
	<title>Particle Designer</title>
	<link rel="stylesheet" href="javascripts/third/ext/ext-4.1.1a/resources/css/ext-all.css" />
	<style>
		#canvas {
		}
		#uiRoot {
		}
	</style>
</head>
<body>
	<script type="text/javascript" src="javascripts/third/underscore-min.js"></script>
	<script type="text/javascript" src="javascripts/third/stats.min.js"></script>

	<script type="text/javascript" src="javascripts/particlesystem/util.js"></script>
	<script type="text/javascript" src="javascripts/particlesystem/Particle.js"></script>
	<script type="text/javascript" src="javascripts/particlesystem/Emitter.js"></script>
	<script type="text/javascript" src="javascripts/particlesystem/Renderer.js"></script>

	<script type="text/javascript" src="javascripts/third/ext/ext-4.1.1a/ext-all.js"></script>
	<script type="text/javascript" src="javascripts/ui/VectorField.js"></script>
	<script type="text/javascript" src="javascripts/ui/ColorField.js"></script>
	<script type="text/javascript" src="javascripts/ui/NumberField.js"></script>
	<script type="text/javascript" src="javascripts/ui/Parser.js"></script>
	<script type="text/javascript" src="javascripts/ui/Builder.js"></script>

	<script type="text/javascript">
	function getUrlParam(name) {
		name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
		var regexS = "[\\?&]" + name + "=([^&#]*)";
		var regex = new RegExp(regexS);
		var results = regex.exec(window.location.href);
		if (results == null) return "";
		else return results[1];
	}
	
	Ext.onReady(function() {
	this.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame || function(callback) {
		window.setTimeout(callback, 1 / 60 * 1000);
	};

		var lastTimestamp = 0;
		var texture = new Image();
		texture.src = 'particle.png';
		var particleSystem;
		this.ps = particleSystem = new pjs.Emitter({
			totalParticles: 300,
			emissionRate: 50,
			pos: { x: 200, y: 200 },
			angle: 0,
			angleVar: 360,
			speed: 20,
			speedVar: 10,
			life: 7,
			lifeVar: 4,
			radialAccel: -20,
			radialAccelVar: 0,
			tangentialAccel: 15,
			tangentialAccelVar: 0,
			radius: 10,
			radiusVar: 4,
			startScale: 1,
			endScale: 0,
			texture: texture,
			startColor: [1, 0.5, 0, 0.8],
			endColor: [0, 0, 0, 0],
			active: true,
			duration: Infinity
		});

		var canvas = document.createElement('canvas');
		canvas.width = 400;
		canvas.height = 400;
		var context = canvas.getContext('2d');

		function draw(timestamp) {
			var delta = timestamp - (lastTimestamp || timestamp);
			lastTimestamp = timestamp;

			delta /= 1000;
			particleSystem.update(delta);

			context.fillStyle = 'black';
			context.fillRect(0, 0, context.canvas.width, context.canvas.height);

			pjs.Renderer.render(context, particleSystem.particles);
			
			requestAnimationFrame(draw);
		}

		pjs.ui.Builder.build(particleSystem, canvas, getUrlParam('ui'));

		draw(new Date().getTime());
	});
	</script>
</body>
</html>

